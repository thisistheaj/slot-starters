<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explore Templates - Slot</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.7.2/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .tag-cloud {
            max-height: 200px;
            overflow-y: auto;
        }
        .chip {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .chip.selected {
            @apply bg-primary text-primary-content;
        }
    </style>
</head>
<body>
    <div class="navbar bg-base-100">
        <div class="navbar-start">
            <a href="/" class="btn btn-ghost text-xl">Slot</a>
        </div>
        <div class="navbar-end">
            <a href="/explore" class="btn btn-primary">Explore Templates</a>
        </div>
    </div>

    <div class="p-8">
        <div class="max-w-7xl mx-auto">
            <h1 class="text-4xl font-bold mb-8">Explore Templates</h1>
            
            <!-- Filters -->
            <div class="mb-8">
                <div class="collapse bg-base-200">
                    <input type="checkbox" checked /> 
                    <div class="collapse-title text-xl font-medium">
                        Filters
                    </div>
                    <div class="collapse-content">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Technologies Filter -->
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text text-lg">Technologies</span>
                                </label>
                                <div id="techCloud" class="tag-cloud flex flex-wrap gap-2 p-4 bg-base-100 rounded-box">
                                    <!-- Populated by JavaScript -->
                                </div>
                            </div>

                            <!-- Features Filter -->
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text text-lg">Features</span>
                                </label>
                                <div id="featureCloud" class="tag-cloud flex flex-wrap gap-2 p-4 bg-base-100 rounded-box">
                                    <!-- Populated by JavaScript -->
                                </div>
                            </div>
                        </div>

                        <!-- Quality Filter -->
                        <div class="form-control mt-6">
                            <label class="label">
                                <span class="label-text text-lg">Minimum Quality Score</span>
                            </label>
                            <input type="range" id="qualityFilter" min="1" max="5" value="1" class="range" step="1" />
                            <div class="w-full flex justify-between text-xs px-2">
                                <span>1</span>
                                <span>2</span>
                                <span>3</span>
                                <span>4</span>
                                <span>5</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Templates Grid -->
            <div id="templatesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Template cards will be inserted here -->
            </div>

            <!-- Loading State -->
            <div id="loadingState" class="text-center py-12">
                <span class="loading loading-spinner loading-lg"></span>
            </div>
        </div>
    </div>

    <script type="module">
        // Import all starters
        const starters = await import('./importable-starters/index.js');
        
        // Selected filters state
        const selectedTechs = new Set();
        const selectedFeatures = new Set();
        
        // Helper function to get average quality score
        function getQualityScore(quality) {
            if (!quality) return 1;
            const scores = [
                quality.maintenance?.commitFrequency || 1,
                quality.maintenance?.issueResponseTime || 1,
                quality.documentation?.readmeCompleteness || 1,
                quality.documentation?.setupInstructions || 1,
                quality.documentation?.exampleCoverage || 1
            ];
            return Math.round(scores.reduce((a, b) => a + b, 0) / scores.length);
        }

        // Helper function to get all unique technologies
        function getAllTechnologies(starters) {
            const techs = new Set();
            Object.values(starters).forEach(starter => {
                if (starter.technologies) {
                    starter.technologies.forEach(tech => techs.add(tech));
                }
            });
            return Array.from(techs).sort();
        }

        // Helper function to get all unique features
        function getAllFeatures(starters) {
            const features = new Set();
            Object.values(starters).forEach(starter => {
                if (starter.features) {
                    Object.entries(starter.features).forEach(([category, categoryFeatures]) => {
                        Object.entries(categoryFeatures).forEach(([feature, hasFeature]) => {
                            if (hasFeature) {
                                features.add(`${category}.${feature}`);
                            }
                        });
                    });
                }
            });
            return Array.from(features).sort();
        }

        // Create chip element
        function createChip(text, type) {
            const chip = document.createElement('div');
            chip.className = 'chip badge badge-lg p-4 hover:badge-primary cursor-pointer';
            chip.textContent = type === 'feature' ? text.replace('.', ': ') : text;
            chip.dataset.value = text;
            
            chip.addEventListener('click', () => {
                const selected = chip.classList.toggle('selected');
                const value = chip.dataset.value;
                const set = type === 'feature' ? selectedFeatures : selectedTechs;
                
                if (selected) {
                    set.add(value);
                } else {
                    set.delete(value);
                }
                
                renderTemplates();
            });
            
            return chip;
        }

        // Populate tag clouds
        function populateTagClouds() {
            const technologies = getAllTechnologies(starters);
            const techCloud = document.getElementById('techCloud');
            technologies.forEach(tech => {
                techCloud.appendChild(createChip(tech, 'tech'));
            });

            const features = getAllFeatures(starters);
            const featureCloud = document.getElementById('featureCloud');
            features.forEach(feature => {
                featureCloud.appendChild(createChip(feature, 'feature'));
            });
        }

        // Create template card
        function createTemplateCard(name, data) {
            const qualityScore = getQualityScore(data.quality);
            const card = document.createElement('div');
            card.className = 'card bg-base-200 shadow-xl';
            card.innerHTML = `
                <div class="card-body">
                    <h2 class="card-title">
                        ${name}
                        <div class="badge badge-primary">Score: ${qualityScore}/5</div>
                    </h2>
                    ${data.technologies ? `
                        <div class="flex flex-wrap gap-2 my-2">
                            ${data.technologies.map(tech => `
                                <div class="badge badge-outline">${tech}</div>
                            `).join('')}
                        </div>
                    ` : ''}
                    <div class="card-actions justify-end mt-4">
                        <a href="${data.metadata?.url || '#'}" target="_blank" class="btn btn-primary btn-sm">
                            View Template
                        </a>
                    </div>
                </div>
            `;
            return card;
        }

        // Filter and render templates
        function renderTemplates() {
            const minQuality = parseInt(document.getElementById('qualityFilter').value);
            const grid = document.getElementById('templatesGrid');
            grid.innerHTML = '';

            Object.entries(starters).forEach(([name, data]) => {
                // Apply filters
                if (selectedTechs.size > 0 && !Array.from(selectedTechs).every(tech => 
                    data.technologies?.includes(tech)
                )) {
                    return;
                }

                if (selectedFeatures.size > 0) {
                    const hasAllFeatures = Array.from(selectedFeatures).every(feature => {
                        const [category, featureName] = feature.split('.');
                        return data.features?.[category]?.[featureName];
                    });
                    if (!hasAllFeatures) return;
                }

                if (getQualityScore(data.quality) < minQuality) {
                    return;
                }

                grid.appendChild(createTemplateCard(name, data));
            });
        }

        // Initialize
        document.getElementById('loadingState').style.display = 'none';
        populateTagClouds();
        renderTemplates();

        // Add event listener for quality filter
        document.getElementById('qualityFilter').addEventListener('change', renderTemplates);
    </script>
</body>
</html> 